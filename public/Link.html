<!DOCTYPE html>
<html>

<head>
    <title>EachChat</title>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <style>
        #form {
            background: Gainsboro;
            padding: 0.25rem;
            position: fixed;
            bottom: 0;
            left: 25%;
            right: 25%;
            display: flex;
            height: 3rem;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
            border-radius: 3rem;
            background-image: radial-gradient(circle at 50% -20.71%, #f6ffff 0, #d7effa 25%, #b5def2 50%, #94cceb 75%, #75bbe6 100%);
        }

        #input {
            border: none;
            padding: 0 1rem;
            flex-grow: 1;
            border-radius: 2rem;
            margin: 0.25rem;
        }

        #input:focus {
            outline: none;
        }

        #form>button {
            background-image: radial-gradient(circle at 50% -20.71%, #bae0e6 0, #bbe0e9 6.25%, #bcdfeb 12.5%, #bedfed 18.75%, #c0deef 25%, #c3ddf0 31.25%, #c6dcf1 37.5%, #c9dbf2 43.75%, #cddaf2 50%, #d1d9f2 56.25%, #d5d8f1 62.5%, #d9d7f0 68.75%, #ddd6ee 75%, #e1d5ed 81.25%, #e4d4ea 87.5%, #e8d3e8 93.75%, #ebd2e5 100%);
            border: none;
            padding: 0 1rem;
            margin: 0.25rem;
            border-radius: 3rem;
            outline: none;
            color: cadetblue;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/chatbox.css">
</head>

<body>
        <div class="row text-center">
            <div class="col" id="roomid"></div>
        </div>
        <div id="message">
            <div class="chat-receiver">
                <div><img src="https://ui-avatars.com/api/?background=0081ff&color=ffffff&rounded=flase&size=128&length=4&name=`+ datas.name + `"></div>
                <div>demo</div>
                <div><div class="chat-right_triangle"></div><span>demo</span></div>
            </div>
        </div>
        <form id="form" action="" class="mt-2">
            <input id="input" autocomplete="off" /><button>发送</button>
        </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            var socket = io();
            var messages = document.getElementById('messages');
            var form = document.getElementById('form');
            var input = document.getElementById('input');
            var datas = {}
            var sid = "";
            datas["name"] = getQueryString("name")
            datas["linkcode"] = getQueryString("linkcode")
            $("#roomid").html(`<svg t="1655218678837" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="22768" width="32" height="32"><path d="M515.584 762.9312m-189.3376 0a189.3376 189.3376 0 1 0 378.6752 0 189.3376 189.3376 0 1 0-378.6752 0Z" fill="#FFE6D8" p-id="22769"></path><path d="M352.256 808.1408c0-104.5504 84.7872-189.3376 189.3376-189.3376 60.8256 0 114.8928 28.7232 149.5552 73.3184-28.0576-69.4784-96.0512-118.528-175.5648-118.528-104.5504 0-189.3376 84.7872-189.3376 189.3376 0 43.7248 14.848 83.968 39.7824 116.0192a188.20096 188.20096 0 0 1-13.7728-70.8096z" fill="#FF7B4C" p-id="22770"></path><path d="M376.4736 865.9968c0-104.5504 84.7872-189.3376 189.3376-189.3376 54.016 0 102.656 22.6816 137.1136 58.9312-2.2016-15.1552-6.1952-29.696-11.7248-43.4176-34.6112-44.6464-88.7296-73.3696-149.6064-73.3696-104.5504 0-189.3376 84.7872-189.3376 189.3376 0 25.1904 5.0176 49.152 13.9776 71.1168 3.8912 4.9664 7.9872 9.728 12.3392 14.2848-1.3312-9.0112-2.0992-18.176-2.0992-27.5456z" fill="#FE966C" p-id="22771"></path><path d="M565.8112 676.6592c-104.5504 0-189.3376 84.7872-189.3376 189.3376 0 9.3184 0.7168 18.432 1.9968 27.392 8.192 8.6528 17.2544 16.4864 26.9312 23.4496 5.12-99.9936 87.808-179.456 189.0816-179.456 41.1136 0 79.104 13.1584 110.1824 35.4816 0.1536-3.2768 0.256-6.6048 0.256-9.9328 0-9.3184-0.7168-18.432-1.9968-27.392-34.5088-36.2496-83.1488-58.88-137.1136-58.88z" fill="#FFB392" p-id="22772"></path><path d="M697.8048 814.2848c3.7376-13.312 6.0928-27.1872 6.8608-41.472a188.27776 188.27776 0 0 0-110.1824-35.3792c-101.2736 0-183.9616 79.4624-189.0816 179.456 10.5472 7.5776 21.9648 14.08 33.9968 19.4048 22.3744-79.616 95.488-138.0352 182.2208-138.0352 27.136-0.0512 52.8896 5.7344 76.1856 16.0256z" fill="#FEC3A6" p-id="22773"></path><path d="M621.6192 798.208c-86.784 0-159.8464 58.4192-182.2208 138.0352 14.1312 6.1952 29.1328 10.752 44.8 13.3632 32.1536-58.624 94.464-98.4064 166.0928-98.4064 10.7008 0 21.1968 0.9216 31.3856 2.6624 6.8096-12.4416 12.2368-25.7024 16.128-39.6288a188.0064 188.0064 0 0 0-76.1856-16.0256z" fill="#FED9C4" p-id="22774"></path><path d="M515.584 509.2352c-66.6112 0-120.7808-54.1696-120.7808-120.7808s54.1696-120.7808 120.7808-120.7808 120.7808 54.1696 120.7808 120.7808-54.1696 120.7808-120.7808 120.7808z m0-159.6928c-21.4528 0-38.8608 17.4592-38.8608 38.8608s17.4592 38.8608 38.8608 38.8608 38.8608-17.4592 38.8608-38.8608-17.408-38.8608-38.8608-38.8608z" fill="#373E51" p-id="22775"></path><path d="M753.0496 884.8384a40.96 40.96 0 0 1-39.424-29.952c-4.6592-16.7936-8.6016-28.416-14.1824-37.9904a803.7376 803.7376 0 0 1-44.4928 54.2208 40.9856 40.9856 0 0 1-30.5664 13.6704h-217.6c-11.6736 0-22.784-4.9664-30.5664-13.6704a833.1264 833.1264 0 0 1-44.4928-54.2208c-5.5808 9.5232-9.5232 21.1968-14.1824 37.9904a40.97024 40.97024 0 0 1-43.4688 29.7472c-87.1936-8.6016-143.4624-68.8128-150.5792-161.1776-6.7072-93.696 26.368-174.0288 93.5936-228.8128 3.072-162.7136 94.7712-293.5296 173.1072-375.9104 32.9216-34.6624 77.4656-53.7088 125.3888-53.7088 47.9232 0 92.416 19.0976 125.3888 53.7088 78.336 82.3808 170.0864 213.1968 173.1072 375.9616 67.2256 54.7328 100.3008 135.0656 93.5936 228.608-7.1168 92.5184-63.3856 152.7808-150.5792 161.3824-1.3824 0.1024-2.7136 0.1536-4.0448 0.1536z m-327.6288-81.92h180.3264c20.0192-23.5008 37.7856-47.3088 53.0944-70.9632a40.97024 40.97024 0 0 1 57.7024-11.52c33.6896 23.2448 51.2 45.7728 63.488 75.008 27.8016-12.2368 42.9056-38.0928 45.9776-78.2848 5.2736-73.1648-20.3776-129.8944-76.2368-168.448a40.9856 40.9856 0 0 1-17.664-34.9184c4.3008-144.5376-79.4624-263.936-150.4768-338.6368-17.3056-18.2272-40.7552-28.2624-65.9968-28.2624-25.2416 0-48.6912 10.0352-65.9968 28.2624-71.0144 74.7008-154.7776 194.0992-150.4768 338.6368a40.9856 40.9856 0 0 1-17.664 34.9184c-55.8592 38.5024-81.4592 95.2832-76.1856 168.6528 3.072 39.9872 18.176 65.792 45.9776 78.08 12.288-29.2352 29.7472-51.7632 63.488-75.008a41.04704 41.04704 0 0 1 31.2832-6.4512c10.8544 2.1504 20.3776 8.6528 26.4192 17.9712 15.104 23.6544 32.9216 47.4624 52.9408 70.9632z" fill="#373E51" p-id="22776"></path></svg>` + "房间号:" + getQueryString("linkcode"))
            socket.emit('join room', datas);
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                let tempval = input.value
                if (input.value && tempval.trim()) {
                    datas["msg"] = $('#input').val()
                    console.log($('#input').val())
                    console.log(datas.msg)
                    datas['sid'] = sid

                    socket.emit('send message', datas);
                    input.value = '';
                }
                input.value = ''
            });
            // client-side
            socket.on("connect", () => {
                sid = socket.id; // ojIckSD2jqNzOqIrAGzL
            });
            socket.on('send message', function (datas) {
                if (sid == datas.sid) {
                    var html = `<div class="chat-receiver">
                            <div><img src="https://ui-avatars.com/api/?background=0081ff&color=ffffff&rounded=flase&size=128&length=4&name=`+ datas.name + `"></div>
                            <div>`+ datas.name + `</div>
                            <div><div class="chat-right_triangle"></div><span>`+ datas.msg.replaceAll(" ", "&nbsp;") + `</span></div>
                            </div>`

                    $("#message").append(html)
                    window.scrollTo(0, document.body.scrollHeight);
                }
                else {
                    var html = `<div class="chat-sender">
                            <div><img src="https://ui-avatars.com/api/?background=0081ff&color=ffffff&rounded=flase&size=128&length=4&name=`+ datas.name + `"></div>
                            <div>`+ datas.name + `</div>
                            <div><div class="chat-left_triangle"></div><span>`+ datas.msg.replaceAll(" ", "&nbsp;") + `</span></div>
                            </div>`
                    $("#message").append(html)
                    window.scrollTo(0, document.body.scrollHeight);
                }
            });

            socket.on('notice', function (datas) {
                $("#message").append(`<div class="chat-notice">
            <span>`+ datas.msg + `</span>
        </div>`)
            });

        });

    </script>
</body>

</html>